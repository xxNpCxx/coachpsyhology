# ü§ñ –£–ª—É—á—à–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ Telegram Bot - Cursor AI

## üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–´–ï –î–û–ü–û–õ–ù–ï–ù–ò–Ø

### 1. –ê–†–•–ò–¢–ï–ö–¢–£–†–ê –ë–ê–ó–´ –î–ê–ù–ù–´–•
**–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –¥–ª—è –≤—Å–µ—Ö Telegram –±–æ—Ç–æ–≤ —Å –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å—é:**

```javascript
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–ê–Ø —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î
CREATE TABLE users (
  id SERIAL PRIMARY KEY,
  telegram_id BIGINT UNIQUE NOT NULL,  // Telegram ID –∫–∞–∫ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–ª—é—á
  username VARCHAR(255),
  first_name VARCHAR(255),
  last_name VARCHAR(255),
  language_code VARCHAR(10),
  is_admin BOOLEAN DEFAULT FALSE,      // –§–ª–∞–≥ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

// ‚úÖ –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
CREATE INDEX idx_users_telegram_id ON users(telegram_id);
CREATE INDEX idx_users_is_admin ON users(is_admin);
```

### 2. –°–ò–°–¢–ï–ú–ê –ú–ò–ì–†–ê–¶–ò–ô
**–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –¥–ª—è production –ø—Ä–æ–µ–∫—Ç–æ–≤:**

```javascript
// migrations/migrate.js
async function runMigrations() {
  await ensureMigrationsTable();
  const applied = await getAppliedMigrations();
  
  const files = fs.readdirSync('migrations')
    .filter(f => f.endsWith('.sql'))
    .sort();
    
  for (const file of files) {
    if (!applied.has(file)) {
      const sql = fs.readFileSync(`migrations/${file}`, 'utf8');
      await applyMigration(file, sql);
    }
  }
}
```

### 3. –°–ï–†–í–ò–°–ù–´–ô –°–õ–û–ô
**–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏:**

```javascript
// services/userService.js
class UserService {
  async upsertUser(userData) {
    // –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
  }
  
  async isAdmin(telegramId) {
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
  }
}

// services/testResultService.js
class TestResultService {
  async saveTestResults(userId, results) {
    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ç–µ—Å—Ç–æ–≤
  }
}
```

### 4. –ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–¨ –° REPLY –ö–õ–ê–í–ò–ê–¢–£–†–û–ô
**–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–æ—Ç–æ–º:**

```javascript
// keyboards/adminKeyboards.js
function getAdminMainKeyboard() {
  return Markup.keyboard([
    ['üë• –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π', 'üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞'],
    ['üîç –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è', 'üì® –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ'],
    ['‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏', 'üîô –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é']
  ]).resize();
}
```

### 5. –û–ë–†–ê–ë–û–¢–ö–ê –°–û–°–¢–û–Ø–ù–ò–ô –ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–ò
**–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤:**

```javascript
// –°–æ—Å—Ç–æ—è–Ω–∏–µ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
const adminStates = new Map();

// –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
bot.use(async (ctx, next) => {
  if (ctx.message && ctx.message.text && !ctx.message.text.startsWith('/')) {
    const handled = await adminPanel.handleTextMessage(ctx);
    if (handled) {
      return; // –°–æ–æ–±—â–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å—é
    }
  }
  await next();
});
```

## üî• –ù–û–í–´–ï –ü–†–ê–í–ò–õ–ê –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò

### 1. –ü–†–û–í–ï–†–ö–ê –ü–†–ê–í –ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–†–ê
```javascript
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û - –¥–≤–æ–π–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
async function checkAdminRights(ctx) {
  const userId = ctx.from.id;
  
  // 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ë–î
  const user = await userService.getUserByTelegramId(userId);
  if (user && user.is_admin) return true;
  
  // 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è
  const adminUserId = process.env.ADMIN_USER_ID;
  if (adminUserId && userId.toString() === adminUserId) {
    return true;
  }
  
  return false;
}
```

### 2. –ü–ê–†–ê–ú–ï–¢–†–ò–ó–û–í–ê–ù–ù–´–ï SQL –ó–ê–ü–†–û–°–´
```javascript
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û
await pool.query('SELECT * FROM users WHERE telegram_id = $1', [userId]);

// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û
await pool.query(`SELECT * FROM users WHERE telegram_id = ${userId}`);
```

### 3. –û–ë–†–ê–ë–û–¢–ö–ê –û–®–ò–ë–û–ö –ë–î
```javascript
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û
try {
  await userService.upsertUser(userData);
} catch (error) {
  console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î:', error);
  // –ù–µ –ø—Ä–µ—Ä—ã–≤–∞–µ–º —Ä–∞–±–æ—Ç—É –±–æ—Ç–∞ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –ë–î
}
```

## üìã –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ô –ß–ï–ö-–õ–ò–°–¢ –î–õ–Ø –ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–ò

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:
- [ ] –¢–∞–±–ª–∏—Ü–∞ `users` —Å –ø–æ–ª–µ–º `is_admin`
- [ ] –¢–∞–±–ª–∏—Ü–∞ `test_results` –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- [ ] –¢–∞–±–ª–∏—Ü–∞ `question_answers` –¥–ª—è –æ—Ç–≤–µ—Ç–æ–≤
- [ ] –°–∏—Å—Ç–µ–º–∞ –º–∏–≥—Ä–∞—Ü–∏–π –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞
- [ ] –ò–Ω–¥–µ–∫—Å—ã —Å–æ–∑–¥–∞–Ω—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å:
- [ ] –ö–æ–º–∞–Ω–¥–∞ `/admin` –¥–ª—è –≤—Ö–æ–¥–∞
- [ ] Reply –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- [ ] –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- [ ] –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- [ ] –ü—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–æ—Ñ–∏–ª–µ–π –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- [ ] –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
- [ ] –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–∞–º–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:
- [ ] –í—Å–µ SQL –∑–∞–ø—Ä–æ—Å—ã –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω—ã
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
- [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –±–µ–∑ —É—Ç–µ—á–∫–∏ –¥–∞–Ω–Ω—ã—Ö
- [ ] –¢–æ–∫–µ–Ω—ã –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
- [ ] –ü–∞–≥–∏–Ω–∞—Ü–∏—è –¥–ª—è –±–æ–ª—å—à–∏—Ö —Å–ø–∏—Å–∫–æ–≤
- [ ] –ò–Ω–¥–µ–∫—Å—ã –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- [ ] –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- [ ] –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤

## üö´ –ó–ê–ü–†–ï–©–ï–ù–û –í –ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–ò

1. **–•–∞—Ä–¥–∫–æ–¥ ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤** - —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
2. **–ü—Ä—è–º—ã–µ SQL –∑–∞–ø—Ä–æ—Å—ã** - —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–∏—Å—ã
3. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤** - –≤—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π –ø—Ä–∞–≤–∞
4. **–ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ –ë–î** - –ª–æ–≥–∏—Ä—É–π –≤—Å–µ –æ—à–∏–±–∫–∏
5. **–û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö** - –≤–∞–ª–∏–¥–∏—Ä—É–π –≤—ã–≤–æ–¥
6. **–ë–ª–æ–∫–∏—Ä—É—é—â–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏** - –∏—Å–ø–æ–ª—å–∑—É–π async/await
7. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞** - —Å–æ–∑–¥–∞–≤–∞–π –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

## ‚úÖ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –í –ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–ò

1. **–°–µ—Ä–≤–∏—Å–Ω—ã–π —Å–ª–æ–π** - —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏
2. **–°–∏—Å—Ç–µ–º–∞ –º–∏–≥—Ä–∞—Ü–∏–π** - –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ë–î
3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π** - –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤
4. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π** - –¥–ª—è –∞—É–¥–∏—Ç–∞
5. **–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
6. **Graceful degradation** - —Ä–∞–±–æ—Ç–∞ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –ë–î
7. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** - –æ–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π

## üîß –®–ê–ë–õ–û–ù –ù–û–í–û–ì–û –ü–†–û–ï–ö–¢–ê

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫:
```
project/
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ database.js
‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îî‚îÄ‚îÄ adminPanel.js
‚îú‚îÄ‚îÄ keyboards/
‚îÇ   ‚îî‚îÄ‚îÄ adminKeyboards.js
‚îú‚îÄ‚îÄ migrations/
‚îÇ   ‚îú‚îÄ‚îÄ migrate.js
‚îÇ   ‚îî‚îÄ‚îÄ 001_create_tables.sql
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ userService.js
‚îÇ   ‚îî‚îÄ‚îÄ testResultService.js
‚îú‚îÄ‚îÄ index.js
‚îú‚îÄ‚îÄ package.json
‚îî‚îÄ‚îÄ README.md
```

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
```json
{
  "dependencies": {
    "telegraf": "^4.12.2",
    "pg": "^8.11.3",
    "dotenv": "^16.3.1"
  },
  "devDependencies": {
    "nodemon": "^3.0.2"
  }
}
```

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
```env
BOT_TOKEN=your_token
DATABASE_URL=postgresql://...
ADMIN_USER_ID=123456789
ADMIN_PANEL_ENABLED=true
```

## üéØ –ü–†–ò–û–†–ò–¢–ï–¢–´ –†–ê–ó–†–ê–ë–û–¢–ö–ò

1. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –≤—Å–µ–≥–¥–∞ –Ω–∞ –ø–µ—Ä–≤–æ–º –º–µ—Å—Ç–µ
2. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
3. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–ª—è —Ä–æ—Å—Ç–∞
4. **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å** - —á–∏—Å—Ç—ã–π –∫–æ–¥ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
5. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç** - —É–¥–æ–±–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

---

**–ü–æ–º–Ω–∏: –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å - —ç—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–∞—è —á–∞—Å—Ç—å –±–æ—Ç–∞. –û—Ç–Ω–æ—Å–∏—Å—å –∫ –Ω–µ–π —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å—é!**
description:
globs:
alwaysApply: false
---
