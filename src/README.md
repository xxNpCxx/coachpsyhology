# ü§ñ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Telegram Bot - –ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
src/
‚îú‚îÄ‚îÄ bot.js                  # üöÄ –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞, middleware pipeline
‚îú‚îÄ‚îÄ config.js               # ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ commands/               # üìú –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ start.js           # /start –∫–æ–º–∞–Ω–¥–∞
‚îÇ   ‚îî‚îÄ‚îÄ admin.js           # /admin –∫–æ–º–∞–Ω–¥–∞  
‚îú‚îÄ‚îÄ scenes/                 # üé≠ FSM —Å—Ü–µ–Ω—ã –¥–ª—è –¥–∏–∞–ª–æ–≥–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ test.scene.js      # –°—Ü–µ–Ω–∞ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —Ç–µ—Å—Ç–∞
‚îú‚îÄ‚îÄ handlers/               # üéØ –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ globalHandlers.js  # –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
‚îÇ   ‚îî‚îÄ‚îÄ admin/             # –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
‚îÇ       ‚îî‚îÄ‚îÄ adminPanel.js  # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
‚îú‚îÄ‚îÄ pg/                     # üóÑÔ∏è –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ª–æ–π —Ä–∞–±–æ—Ç—ã —Å –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ users.pg.js        # –û–ø–µ—Ä–∞—Ü–∏–∏ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
‚îÇ   ‚îî‚îÄ‚îÄ tests.pg.js        # –û–ø–µ—Ä–∞—Ü–∏–∏ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ —Ç–µ—Å—Ç–æ–≤
‚îú‚îÄ‚îÄ utils/                  # üõ†Ô∏è –£—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ cache.js           # –°–∏—Å—Ç–µ–º–∞ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ logger.js          # –°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
‚îî‚îÄ‚îÄ keyboards.js            # ‚å®Ô∏è UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
```

## üöÄ –ö–ª—é—á–µ–≤—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### 1. üíæ **–°–∏—Å—Ç–µ–º–∞ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è**
- –ö–µ—à –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ 30 –º–∏–Ω—É—Ç
- –ö–µ—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ç–µ—Å—Ç–æ–≤
- –ö–µ—à —Å–æ—Å—Ç–æ—è–Ω–∏–π FSM —Å—Ü–µ–Ω
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç

### 2. üóÑÔ∏è **–ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ª–æ–π –ë–î**
- –û—Ç–¥–µ–ª–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Å PostgreSQL
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã —Å `::bigint`
- –í—Å—Ç—Ä–æ–µ–Ω–Ω–æ–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- –ú–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

### 3. üé≠ **FSM –°—Ü–µ–Ω—ã**
- –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —Ç–µ—Å—Ç–∞
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ü—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ –∏ –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤

### 4. üìä **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
- –£—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —á–µ—Ä–µ–∑ env –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
- –£–±—Ä–∞–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–æ–≤ 
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–µ—à–∞

### 5. ‚ö° **Production-–≥–æ—Ç–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**
- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ middleware
- Graceful shutdown
- Health check endpoint
- Express —Å–µ—Ä–≤–µ—Ä –¥–ª—è webhook

## üõ†Ô∏è –ö–æ–º–∞–Ω–¥—ã –∑–∞–ø—É—Å–∫–∞

```bash
# –ü—Ä–æ–¥–∞–∫—à–Ω
npm start

# –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞  
npm run dev

# –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
npm run migrate

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–µ—à–∞
npm run cache-stats

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ë–î
npm run test-db
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Health Check
```
GET / - —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–µ—Ä–∞ + —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–µ—à–∞
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
–£–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è env –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏:
- `DEBUG_LOGS=true` - –æ—Ç–ª–∞–¥–æ—á–Ω—ã–µ –ª–æ–≥–∏
- `USER_LOGS=true` - –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π  
- `ADMIN_LOGS=true` - –∞–¥–º–∏–Ω—Å–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è
- `CACHE_LOGS=true` - –æ–ø–µ—Ä–∞—Ü–∏–∏ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
- `DB_LOGS=true` - –∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î

## üîß Middleware Pipeline

```javascript
1. session() middleware         // –ü–ï–†–í–´–ú
2. globalMiddleware            // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è  
3. stage.middleware()          // FSM —Å—Ü–µ–Ω—ã
4. registerCommands()          // –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞
5. registerHandlers()          // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
6. universalCallbackHandler()  // –ü–û–°–õ–ï–î–ù–ò–ú
```

## üéØ –ü—Ä–∏–Ω—Ü–∏–ø—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

- **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏** - –∫–∞–∂–¥—ã–π –º–æ–¥—É–ª—å —Ä–µ—à–∞–µ—Ç —Å–≤–æ—é –∑–∞–¥–∞—á—É
- **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ** - –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞—â–µ–Ω–∏–π –∫ –ë–î
- **–¢–∏–ø–∏–∑–∞—Ü–∏—è** - —è–≤–Ω–æ–µ –ø—Ä–∏–≤–µ–¥–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ –¥–ª—è PostgreSQL  
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ —Ä–æ—Å—Ç—É –Ω–∞–≥—Ä—É–∑–∫–∏